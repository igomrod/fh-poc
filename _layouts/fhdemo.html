<!DOCTYPE html>
<html lang="{{ site.lang | default: "en-US" }}">

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,maximum-scale=2">
    <link rel="stylesheet" type="text/css" media="screen" href="{{ '/assets/css/style.css?v=' | append: site.github.build_revision | relative_url }}">
    <script src="{{ '/assets/js/pdf.js?v=' | append: site.github.build_revision | relative_url }}"></script>
    <script src="{{ '/assets/js/ssdeep.js?v=' | append: site.github.build_revision | relative_url}}"></script>
    <script src="{{ '/assets/js/tlsh.js?v=' | append: site.github.build_revision | relative_url}}"></script>
    <script src="{{ '/assets/js/sjcl.js?v=' | append: site.github.build_revision | relative_url }}"></script>

    <script type="text/javascript">
      function funfun() {
        // Check for the various File API support.
        if (window.File && window.FileReader && window.FileList && window.Blob) {
          // Great success! All the File APIs are supported.
        } else {
            alert('The File APIs are not fully supported in this browser');
        }
      
        document.getElementById('files').addEventListener('change', handleFileSelect, false);
        document.getElementById("text2").value = decodeURI(t2);
      }
      
      var t1;
      var t2 = encodeURI(" Aniversario TEGRA Cybersecurity Center Fecha Miércoles 19 de j unio de 2019 Localización Santiago de Compostela - Casa Grande do Pozo ( Rúa do Vilar, 19, Santiago de Compostela. 15705, A Coruña ) https://goo.gl/maps/Cqjz8bAHvoXP6HcK7 Programa 10 : 00 h : Recepción , registro y café Durante la recepción estar án disponibles unos stands demostrativos con tecnologías innovadoras . 10:30 h : Apertura de la jornada Luis Pérez Freire Director General de Gradiant P edro Pablo Pérez Garcia Vicepresidente de Seguridad de Telefónica y CEO de ElevenPaths 1 1: 00 h : Aniversario de TEGRA: Logros, hitos y futuro Juan Elosua Tomé – Director TEGRA – ElevenPaths Juan González Martínez – Director TEGR A – Gradiant 11 :15 h : Mesa redonda “ Fugas de información: Impacto, control y mitigación ” Moderado r : Fernando Jiménez Míguez – Gerente de Gradiant P onentes : Roberto Baratta Martínez Director de Prevención Pérdidas - Cont inuida d de Negoci o - Seguridad – ABANCA Carlos López Blanco Head of Digital Risk Office – Hijos de Rivera SAU Fernando Suarez Lorenzo Director del Área de Transparencia y Gobierno Abierto – Deputación de Ourense David González González Responsable de seguridad de información – Grupo COREN 1 2 : 15 h : “¿ Innovación para ayudar controlar y tener visibilidad de la información corporativa?” Jose Cascallana Arroyo – Equipo TEGRA Lilian A dkinson Orellana /D iego Pérez Vieites – Equipo TEGRA Roberto Anta Rodríguez – Equipo TEGRA Rafael Mart í nez Álvarez /Iván Gómez Rodr í guez – Equipo TEGRA 1 2 : 45 h : Keynote - Clausura Ignacio González Ubierna Subdirector de tecnologías de ciberseguridad – INCIBE 1 3: 15 h – 14:00h Cocktail Durante el cocktail estarán disponibles unos stands demostrativos con tecnologías innovadora s . ".replace(/\s\s+/g, ' '));
      function handleFileSelect(evt) {
      var files = evt.target.files; // FileList object
      var lectores = new Array();

      // files is a FileList of File objects. List some properties.
      var output = [];
      for (var i = 0, f; f = files[i]; i++) {
        output.push('<li><strong>', escape(f.name), '</strong> (', f.type || 'n/a', ') - ',
            f.size, ' bytes, last modified: ',
            f.lastModifiedDate.toLocaleDateString(), '</li>');
          lectores[i] = new FileReader();
          lectores[i].onload = function(e) {
            /**
          * Extract the text from the PDF
          */
          var PDF_URL  = this.result;
          pdfjsLib.getDocument(PDF_URL).then(function(PDFDocumentInstance) {
              var pagesPromises = [];
              // Extract the text
              for (var i = 0; i < PDFDocumentInstance._pdfInfo.numPages; i++) {
                  (function (pageNumber) {
                  pagesPromises.push(getPageText(pageNumber, PDFDocumentInstance));
                })(i + 1);
              }
              Promise.all(pagesPromises).then(function(pagesText) {
                for (var i = 0, t1u = ""; i < pagesText.length; i++) {
                  t1u += pagesText[i];
                }
                fun_hash(t1u);
              });
          }, function (reason) {
              // PDF loading error
              console.error(reason);
          });

          }

          lectores[i].readAsDataURL(f);
      }
      document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';
    }
      

    /**
    * Retrieves the text of a specif page within a PDF Document obtained through pdf.js 
    * 
    * @param {Integer} pageNum Specifies the number of the page 
    * @param {PDFDocument} PDFDocumentInstance The PDF document obtained 
    **/
    function getPageText(pageNum, PDFDocumentInstance) {
        // Return a Promise that is solved once the text of the page is retrieven
        return new Promise(function (resolve, reject) {
            PDFDocumentInstance.getPage(pageNum).then(function (pdfPage) {
                // The main trick to obtain the text of the PDF page, use the getTextContent method
                pdfPage.getTextContent().then(function (textContent) {
                    var textItems = textContent.items;
                    var finalString = "";
                    // Concatenate the string of the item to the final string
                    for (var i = 0; i < textItems.length; i++) {
                        var item = textItems[i];
                        finalString += item.str + " ";
                    }
                    // Solve promise with the text retrieven from the page
                    resolve(finalString);
                });
            });
        });
    }

      
function fun_hash(t1u) {
      	t1 = encodeURI(t1u.replace(/\s\s+/g, ' '));
	document.getElementById("text1").value = decodeURI(t1);
        var bitArray1 = sjcl.hash.sha256.hash(t1);
        var digest_sha256_1 = sjcl.codec.hex.fromBits(bitArray1);
        document.getElementById("sha256_hash1").value = digest_sha256_1;
        var bitArray2 = sjcl.hash.sha256.hash(t2);
        var digest_sha256_2 = sjcl.codec.hex.fromBits(bitArray2);
        document.getElementById("sha256_hash2").value = digest_sha256_2;

        tick_img_src = "{{ '/assets/images/tick.png' | relative_url }}";
        xicon_img_src = "{{ '/assets/images/x-icon.png' | relative_url }}";

        var tick_img_tag = "<img class=\"tick\" src=\"" + tick_img_src + "\">";
        var xicon_img_tag = "<img class=\"x-icon\" src=\"" + xicon_img_src + "\">";

        if(digest_sha256_1 == digest_sha256_2) {
          document.getElementById("sha256_match").innerHTML = "<span>Cryptographic hash (SHA-256) match: </span>" + tick_img_tag;
        } else {
          document.getElementById("sha256_match").innerHTML = "<span>Cryptographic hash (SHA-256) match: </span>" + xicon_img_tag;
        }
      
        var ssdeep1 = ssdeep.digest(t1);
        var ssdeep2 = ssdeep.digest(t2);
        document.getElementById("ssdeep_hash1").value = ssdeep1;
        document.getElementById("ssdeep_hash2").value = ssdeep2;
        var similarity = ssdeep.similarity(ssdeep1, ssdeep2);
        
        console.log(ssdeep1)
        console.log(ssdeep2)
        
        console.log(similarity)

        document.getElementById("filename_match").innerHTML = "<span>Filename: </span>" + xicon_img_tag;

        var simRounded = (Math.round(similarity*10)/10)
        if( simRounded > 80) {
          document.getElementById("ssdeep_similarity").innerHTML = "<span>Fuzzy Hash (ssdeep): </span>" + simRounded + tick_img_tag;
        } else {
          document.getElementById("ssdeep_similarity").innerHTML = "<span>Fuzzy Hash (ssdeep): </span>" + simRounded + xicon_img_tag;
        }
      
        console.log("T1: " + t1)
        console.log("T2: " + t1)
        var tlsh1 = new Tlsh();
        var tlsh2 = new Tlsh();
        tlsh1.update(t1, t1.length+1);
        tlsh1.finale();
        document.getElementById("tlsh_hash1").value = tlsh1.hash();
        tlsh2.update(t2, t2.length+1);
        tlsh2.finale();
        document.getElementById("tlsh_hash2").value = tlsh2.hash();
        var tlsh_diff = tlsh1.totalDiff(tlsh2, !document.getElementById("tlsh_iglen").checked)
        document.getElementById("tlsh_diffh").innerHTML = "TLSH diff = " + tlsh_diff;
        var tlsh_simil = Math.round(100.0*Math.exp(-Math.pow(tlsh_diff/40.0, 2))*10.0)/10.0 + "%";
        document.getElementById("tlsh_simil").innerHTML = "TLSH similarity = " + tlsh_simil;

        if((Math.round(100.0*Math.exp(-Math.pow(tlsh_diff/40.0, 2))*10.0)/10.0) > 80) {
          document.getElementById("tlsh_simil").innerHTML = "<span>Fuzzy Hash (tlsh): </span>" + tick_img_tag;
        } else {
          document.getElementById("tlsh_simil").innerHTML = "<span>Fuzzy Hash (tlsh): </span>" + xicon_img_tag;
        }

      }
      
      </script>      
  </head>

  <body onload="funfun()">

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <img title="TEGRA" src="{{ '/assets/images/tegralogo.png' | relative_url }}">
       </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        {{ content }}

        <center>
          <div class="upload-btn-wrapper">
            <button class="btn">Upload a PDF file</button>
            <input type="file" id="files" name="files[]" />
          </div>
        </center>

        <output id="list"></output>
        <div id="results_wrapper">
        <div id="basedocument">
            <h4>Master PDF Document</h4>
            <a href="{{ '/assets/pdf/Programa_aniversario_tegra_maestro.pdf' | relative_url }}"><img src="{{ '/assets/images/masterpdfthumbnail.png' | relative_url }}"></a>
        </div>
        <div id="results">
          <h4>Document Comparision Results</h4>
          <table class="hidden">
          <tr>
          <td>
          <b>User PDF</b>
          </td><td>
          <b>Reference PDF</b>
          </td>
          </tr>
          <tr>
          <td>
          <textarea id="text1" class="hidden" rows="16" cols="90" readonly></textarea>
          </td><td>
          <textarea id="text2" class="hidden"rows="16" cols="90" readonly></textarea>
          </td>
          </tr>
          <tr>
          <td colspan="2">
          <center><b>SHA-256 hashes</b></center>
          </td>
          </tr>
          <tr>
          <td>
          <input id="sha256_hash1" size="91">
          </td><td>
          <input id="sha256_hash2" size="91">
          </td>
          </tr>
          <tr>
          <td colspan="2">
          <center><b>ssdeep hashes</b></center>
          </td>
          </tr>
          <tr>
          <td>
          <input id="ssdeep_hash1" size="91">
          </td><td>
          <input id="ssdeep_hash2" size="91">
          </td>
          </tr>
          <tr>
          <td colspan="2">
          <center><b>TLSH hashes</b></center>
          </td>
          </tr>
          <tr>
          <td>
          <input id="tlsh_hash1" size="91">
          </td><td>
          <input id="tlsh_hash2" size="91">
          </td>
          </tr>
          </table>
        </div>
        </div>
          <br>
          <span class="hidden">TLSH ignore len <input type="checkbox" id="tlsh_iglen"></span>
           <b>
          <span id="filename_match"></span> 
          <br><br>                 
          <span id="sha256_match"></span>
          <br><br>
          <span id="ssdeep_similarity"></span>
          <span style="display:none;" id="tlsh_diffh"></span>
          <span style="display:none;" id="tlsh_simil"></span>
          </b>
          <br><br>
        </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p><em>TEGRA cybersecurity center se enmarca en la unidad mixta de investigación en ciberseguridad IRMAS (Information Rights Management Advanced Systems), que está cofinanciada por la Unión Europea, en el marco del Programa Operativo FEDER Galicia 2014-2020, para promover el desarrollo tecnológico, la innovación y una investigación de calidad.</em></p>
        <img src="{{ '/assets/images/footerlogos.png' | relative_url }}"/>
        {% if site.github.is_project_page %}
        <p class="copyright">Copyright 2019</p>
        {% endif %}</p>
      </footer>
    </div>

    {% if site.google_analytics %}
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', '{{ site.google_analytics }}', 'auto');
        ga('send', 'pageview');
      </script>
    {% endif %}
  </body>
</html>
